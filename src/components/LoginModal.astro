---
import Button from "@components/Button.astro";
---

<div
  id="login-modal"
  class="modal"
  aria-hidden="true"
  role="dialog"
  aria-modal="true"
>
  <button class="modal__overlay" aria-label="Close login modal" data-close-modal
  ></button>

  <div class="modal__dialog" role="document">
    <button class="modal__close" aria-label="Close" data-close-modal>Ã—</button>

    <h2 class="modal__title">Dashboard Login</h2>

    <form class="form" onsubmit="return false;">
      <label for="login-email">Email address</label>
      <input id="login-email" name="email" type="email" required />

      <label for="login-password">Password</label>
      <input id="login-password" name="password" type="password" required />

      <Button
        type="submit"
        variant="yellow"
        size="newsletter"
        label="Go to dashboard"
      />
    </form>
  </div>
</div>

<style>
  @layer components.modal {
    .modal {
      position: fixed;
      inset: 0;
      opacity: 0;
      visibility: hidden;
      pointer-events: none;
      transition:
        opacity 0.28s ease,
        visibility 0s linear 0.28s;
      z-index: 1000;
    }
    .modal.is-open {
      opacity: 1;
      visibility: visible;
      pointer-events: auto;
      transition:
        opacity 0.28s ease,
        visibility 0s;
    }

    .modal__overlay {
      position: absolute;
      inset: 0;
      background: rgba(0, 0, 0, 0);
      opacity: 0;
      backdrop-filter: blur(0px);
      -webkit-backdrop-filter: blur(0px);
      border: 0;
      margin: 0;
      padding: 0;
      cursor: default;

      transition:
        opacity 0.28s ease,
        background 0.28s ease,
        backdrop-filter 0.28s ease,
        -webkit-backdrop-filter 0.28s ease;
      will-change: opacity, backdrop-filter;
    }
    .modal.is-open .modal__overlay {
      background: rgba(0, 0, 0, 0.35);
      opacity: 1;
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
    }

    .modal__dialog {
      position: absolute;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -48%) scale(0.96);
      opacity: 0;

      background: #181818;
      color: #fff;
      width: min(90vw, 430px);
      border-radius: 30px;
      padding: 80px 100px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.35);

      transition:
        transform 0.28s cubic-bezier(0.2, 0.8, 0.2, 1),
        opacity 0.28s ease;
      will-change: transform, opacity;
    }
    .modal.is-open .modal__dialog {
      transform: translate(-50%, -50%) scale(1);
      opacity: 1;
    }

    .modal__close {
      position: absolute;
      top: 10px;
      right: 14px;
      border: 0;
      background: transparent;
      color: #fff;
      font-size: 28px;
      cursor: pointer;
      line-height: 1;
      opacity: 0.6;
      transition: opacity 0.2s;
    }
    .modal__close:hover {
      opacity: 1;
    }

    .modal__title {
      margin: 0 0 46px;
      text-align: center;
      font-family: "Cabin", sans-serif;
      font-size: 45px;
      font-weight: 700;
      line-height: 116%;
    }

    .form {
      display: flex;
      flex-direction: column;
      gap: 30px;
      width: min(100%, 387px);
      margin-inline: auto;
    }
    .form label {
      color: #fff;
      font-family: "Cabin", sans-serif;
      font-size: 18px;
      font-weight: 400;
      line-height: 116%;
    }
    .form input {
      height: 59px;
      padding: 20px;
      border-radius: 4px;
      border: 1px solid #e3e3e3;
      background: #fff;
      color: #181818;
      font-family: "Lato", sans-serif;
      font-size: 16px;
      outline: none;
      transition:
        border-color 0.2s,
        box-shadow 0.2s;
    }
    .form input:focus {
      border-color: #ffcc4a;
      box-shadow: 0 0 0 3px rgba(255, 204, 74, 0.3);
    }

    :global(body.no-scroll) {
      overflow: hidden;
    }

    @media (prefers-reduced-motion: reduce) {
      .modal,
      .modal__overlay,
      .modal__dialog {
        transition: none !important;
      }
      .modal__dialog {
        transform: translate(-50%, -50%) scale(1) !important;
        opacity: 1 !important;
      }
      .modal__overlay {
        background: rgba(0, 0, 0, 0.35);
        opacity: 1;
        backdrop-filter: blur(8px);
        -webkit-backdrop-filter: blur(8px);
      }
    }

    @media (max-width: 520px) {
      .modal__dialog {
        padding: 56px 32px;
      }
    }
  }
</style>

<script>
  (function () {
    const modal = document.getElementById("login-modal");
    if (!modal) return;

    function open() {
      modal.classList.add("is-open");
      document.body.classList.add("no-scroll");
      setTimeout(() => document.getElementById("login-email")?.focus(), 0);
    }

    function close() {
      modal.classList.remove("is-open");
      document.body.classList.remove("no-scroll");
    }

    function wireOpeners() {
      document.querySelectorAll('[data-open-modal="login"]').forEach((el) => {
        el.addEventListener("click", (e) => {
          e.preventDefault();
          open();
        });
      });
    }
    wireOpeners();

    modal.addEventListener("click", (e) => {
      if (e.target.matches("[data-close-modal], .modal__overlay")) close();
    });
    document.addEventListener("keydown", (e) => {
      if (e.key === "Escape" && modal.classList.contains("is-open")) close();
    });

    new MutationObserver(wireOpeners).observe(document.body, {
      childList: true,
      subtree: true,
    });
  })();
</script>
